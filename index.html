<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Calculator</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }

        :root {
            --ash-gray: #c2d1b8;
            --cambridge-blue: #84a98c;
            --hookers-green: #52796f;
            --dark-slate-gray: #354f52;
            --charcoal: #2f3e46;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4" style="background-color: var(--ash-gray);">

    <!-- Calculator Container -->
    <div class="p-8 md:p-10 rounded-3xl shadow-2xl w-full max-w-lg" style="background-color: var(--cambridge-blue);">
        <h1 class="text-4xl font-extrabold text-center mb-8" style="color: var(--charcoal);">Purchase Calculator</h1>
        
        <!-- Input Fields Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Product Rate Input -->
            <div>
                <label for="rate" class="block font-medium mb-2 text-sm" style="color: var(--dark-slate-gray);">Product Rate (₹)</label>
                <input type="number" id="rate" placeholder="e.g., 100" class="w-full px-4 py-3 border-2 border-white rounded-xl focus:outline-none transition-colors duration-200 text-lg" style="background-color: var(--ash-gray); border-color: var(--dark-slate-gray); color: var(--charcoal); focus:border-color: var(--hookers-green);">
            </div>

            <!-- Discount Input -->
            <div>
                <label for="discount" class="block font-medium mb-2 text-sm" style="color: var(--dark-slate-gray);">Discount (%) - Optional</label>
                <input type="number" id="discount" placeholder="e.g., 10" class="w-full px-4 py-3 border-2 border-white rounded-xl focus:outline-none transition-colors duration-200 text-lg" style="background-color: var(--ash-gray); border-color: var(--dark-slate-gray); color: var(--charcoal); focus:border-color: var(--hookers-green);">
            </div>

            <!-- GST Input -->
            <div>
                <label for="gst" class="block font-medium mb-2 text-sm" style="color: var(--dark-slate-gray);">GST Amount (%)</label>
                <input type="number" id="gst" placeholder="e.g., 18" class="w-full px-4 py-3 border-2 border-white rounded-xl focus:outline-none transition-colors duration-200 text-lg" style="background-color: var(--ash-gray); border-color: var(--dark-slate-gray); color: var(--charcoal); focus:border-color: var(--hookers-green);">
            </div>

            <!-- Profit Margin Input -->
            <div>
                <label for="profitMargin" class="block font-medium mb-2 text-sm" style="color: var(--dark-slate-gray);">Profit Margin (%) - Optional</label>
                <input type="number" id="profitMargin" placeholder="e.g., 20" class="w-full px-4 py-3 border-2 border-white rounded-xl focus:outline-none transition-colors duration-200 text-lg" style="background-color: var(--ash-gray); border-color: var(--dark-slate-gray); color: var(--charcoal); focus:border-color: var(--hookers-green);">
            </div>

            <!-- Quantity Input (New) -->
            <div class="md:col-span-2">
                <label for="quantity" class="block font-medium mb-2 text-sm" style="color: var(--dark-slate-gray);">Quantity per Unit - Optional</label>
                <input type="number" id="quantity" placeholder="e.g., 10" class="w-full px-4 py-3 border-2 border-white rounded-xl focus:outline-none transition-colors duration-200 text-lg" style="background-color: var(--ash-gray); border-color: var(--dark-slate-gray); color: var(--charcoal); focus:border-color: var(--hookers-green);">
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="mt-8">
            <button id="calculateBtn" class="w-full text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:opacity-90 focus:outline-none focus:ring-4 focus:ring-opacity-50 transition-all duration-300 transform hover:-translate-y-1 hover:scale-105" style="background-color: var(--hookers-green); focus-ring-color: var(--dark-slate-gray);">
                Calculate
            </button>
        </div>

        <!-- Results Section -->
        <div class="mt-10 pt-6 border-t-2 border-white" style="border-color: var(--dark-slate-gray);">
            <h2 class="text-2xl font-bold mb-4" style="color: var(--charcoal);">Calculation Summary</h2>
            <div id="results-container" class="space-y-4">
                <!-- Calculated details will be inserted here -->
            </div>
            
            <div class="mt-6 flex flex-col md:flex-row justify-between items-center p-4 rounded-xl shadow-inner" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                <div class="text-center md:text-left">
                    <p class="font-medium text-sm" style="color: var(--charcoal);">Total Purchase Price:</p>
                    <p id="purchasePrice" class="text-3xl font-bold mt-1" style="color: var(--charcoal);">₹0.00</p>
                </div>
                <div class="mt-4 md:mt-0 text-center md:text-right">
                    <p class="font-medium text-sm" style="color: var(--charcoal);">Total Suggested Sale Price:</p>
                    <p id="salePrice" class="text-3xl font-bold mt-1" style="color: var(--hookers-green);">₹0.00</p>
                </div>
            </div>
             <!-- New Per-Quantity Results Section -->
            <div class="mt-4 flex flex-col md:flex-row justify-between items-center p-4 rounded-xl shadow-inner" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                <div class="text-center md:text-left">
                    <p class="font-medium text-sm" style="color: var(--charcoal);">Per Quantity Purchase Price:</p>
                    <p id="perQuantityPurchasePrice" class="text-3xl font-bold mt-1" style="color: var(--charcoal);">₹0.00</p>
                </div>
                <div class="mt-4 md:mt-0 text-center md:text-right">
                    <p class="font-medium text-sm" style="color: var(--charcoal);">Per Quantity Suggested Sale Price:</p>
                    <p id="perQuantitySalePrice" class="text-3xl font-bold mt-1" style="color: var(--hookers-green);">₹0.00</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get all the necessary elements from the DOM
        const rateInput = document.getElementById('rate');
        const discountInput = document.getElementById('discount');
        const gstInput = document.getElementById('gst');
        const profitMarginInput = document.getElementById('profitMargin');
        const quantityInput = document.getElementById('quantity'); // New input
        const calculateBtn = document.getElementById('calculateBtn');
        const purchasePriceEl = document.getElementById('purchasePrice');
        const salePriceEl = document.getElementById('salePrice');
        const perQuantityPurchasePriceEl = document.getElementById('perQuantityPurchasePrice'); // New output
        const perQuantitySalePriceEl = document.getElementById('perQuantitySalePrice'); // New output
        const resultsContainer = document.getElementById('results-container');

        // Add a click event listener to the button
        calculateBtn.addEventListener('click', () => {
            // Get the values and convert them to numbers, defaulting optional ones to 0
            const rate = parseFloat(rateInput.value);
            const discount = discountInput.value === '' ? 0 : parseFloat(discountInput.value);
            const gst = parseFloat(gstInput.value);
            const profitMargin = profitMarginInput.value === '' ? 0 : parseFloat(profitMarginInput.value);
            const quantity = quantityInput.value === '' ? 1 : parseFloat(quantityInput.value);

            // Basic validation to ensure all mandatory inputs are valid numbers
            if (isNaN(rate) || isNaN(gst) || isNaN(discount) || isNaN(profitMargin) || isNaN(quantity)) {
                purchasePriceEl.textContent = 'Invalid input';
                salePriceEl.textContent = 'Invalid input';
                perQuantityPurchasePriceEl.textContent = 'Invalid input';
                perQuantitySalePriceEl.textContent = 'Invalid input';
                resultsContainer.innerHTML = '<p class="text-red-500 font-medium text-center">Please enter valid numbers for Rate and GST.</p>';
                return;
            }

            // 1. Calculate the price after discount
            const discountAmount = rate * (discount / 100);
            const priceAfterDiscount = rate - discountAmount;

            // 2. Calculate the final purchase price after GST
            const gstAmount = priceAfterDiscount * (gst / 100);
            const finalPurchasePrice = priceAfterDiscount + gstAmount;

            // Clear previous results
            resultsContainer.innerHTML = '';
            
            // Build the HTML for the detailed results
            let resultsHtml = `
                <div class="flex justify-between items-center p-3 rounded-lg shadow-sm" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                    <p style="color: var(--dark-slate-gray);">Initial Rate:</p>
                    <p class="font-bold" style="color: var(--charcoal);">₹${rate.toFixed(2)}</p>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg shadow-sm" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                    <p style="color: var(--dark-slate-gray);">Discount Amount (${discount}%):</p>
                    <p class="font-bold text-red-500">-₹${discountAmount.toFixed(2)}</p>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg shadow-sm" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                    <p style="color: var(--dark-slate-gray);">Price after Discount:</p>
                    <p class="font-bold" style="color: var(--charcoal);">₹${priceAfterDiscount.toFixed(2)}</p>
                </div>
                <div class="flex justify-between items-center p-3 rounded-lg shadow-sm" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                    <p style="color: var(--dark-slate-gray);">GST Amount (${gst}%):</p>
                    <p class="font-bold text-green-500">+₹${gstAmount.toFixed(2)}</p>
                </div>
            `;
            
            let finalSalePrice = 0;
            // 3. Check if profit margin is provided before calculating sale price
            if (profitMargin > 0 && profitMargin < 100) {
                // Correct calculation for profit margin
                finalSalePrice = finalPurchasePrice / (1 - (profitMargin / 100));
                const profitAmount = finalSalePrice - finalPurchasePrice;
                
                resultsHtml += `
                    <div class="flex justify-between items-center p-3 rounded-lg shadow-sm" style="background-color: var(--ash-gray); border: 2px solid var(--dark-slate-gray);">
                        <p style="color: var(--dark-slate-gray);">Profit Amount (${profitMargin}% Margin):</p>
                        <p class="font-bold text-green-500">+₹${profitAmount.toFixed(2)}</p>
                    </div>
                `;

                salePriceEl.textContent = `₹${finalSalePrice.toFixed(2)}`;
            } else {
                salePriceEl.textContent = '₹0.00';
            }

            // Update the results container and final prices
            resultsContainer.innerHTML = resultsHtml;
            purchasePriceEl.textContent = `₹${finalPurchasePrice.toFixed(2)}`;

            // 4. Calculate and display per-quantity prices
            if (quantity > 0) {
                const perQuantityPurchasePrice = finalPurchasePrice / quantity;
                perQuantityPurchasePriceEl.textContent = `₹${perQuantityPurchasePrice.toFixed(2)}`;

                if (profitMargin > 0 && profitMargin < 100) {
                    const perQuantitySalePrice = finalSalePrice / quantity;
                    perQuantitySalePriceEl.textContent = `₹${perQuantitySalePrice.toFixed(2)}`;
                } else {
                    perQuantitySalePriceEl.textContent = '₹0.00';
                }
            } else {
                // Reset per-quantity outputs if quantity is not provided or invalid
                perQuantityPurchasePriceEl.textContent = '₹0.00';
                perQuantitySalePriceEl.textContent = '₹0.00';
            }
        });
    </script>
</body>
</html>
